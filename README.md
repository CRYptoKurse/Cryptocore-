# **Отчет по реализации спринта 7 - CryptoCore**

## **Краткое описание Cryptocore**
Cryptocore — это модульное консольное приложение для криптографических операций, включающее шифрование, хеширование, аутентификацию и безопасное получение ключей из паролей.

---

## **Руководство пользователя**

### **1. Команда `derive` - Получение ключа из пароля**

**Назначение:** Безопасное получение криптографических ключей из паролей с использованием PBKDF2-HMAC-SHA256.

**Синтаксис:**
```bash
cryptocore derive [опции]
```

**Опции:**
- `--password PASSWORD` - парольная строка
- `--salt SALT` - соль в hex-формате (если не указана, генерируется 16 случайных байт)
- `--iterations COUNT` - количество итераций (по умолчанию: 100000)
- `--length LENGTH` - длина ключа в байтах (по умолчанию: 32)
- `--algorithm ALGORITHM` - алгоритм (только `pbkdf2`)
- `--output FILE` - файл для записи бинарного ключа
- `--password-file FILE` - чтение пароля из файла
- `--env-var VAR` - чтение пароля из переменной окружения
- `-v, --verbose` - подробный вывод

**Примеры:**
```bash
# Базовое получение ключа
cryptocore derive --password "MyPassword" --salt abc123

# С автогенерацией соли и большим числом итераций
cryptocore derive --password "SecurePass" --iterations 500000 --length 48

# Сохранение в файл
cryptocore derive --password "app_key" --salt fixed123 --output key.bin
```

---

### **2. Команда `encrypt` - Шифрование/дешифрование**

**Назначение:** Шифрование файлов с поддержкой 7 режимов работы AES.

**Синтаксис:**
```bash
cryptocore encrypt [опции]
```

**Основные опции:**
- `--decrypt` - режим дешифрования
- `--algorithm aes` - алгоритм шифрования
- `--mode MODE` - режим: `ecb`, `cbc`, `cfb`, `ofb`, `ctr`, `gcm`, `etm`
- `--key KEY` - ключ в hex-формате
- `--input FILE` - входной файл
- `--output FILE` - выходной файл
- `--iv IV` - вектор инициализации (hex)
- `--aad DATA` - ассоциированные данные для GCM/ETM
- `-v, --verbose` - подробный вывод

**Примеры режимов:**
```bash
# Шифрование в режиме CBC
cryptocore encrypt --algorithm aes --mode cbc --key 001122... --input data.txt

# Шифрование с аутентификацией (GCM)
cryptocore encrypt --mode gcm --key 001122... --input secret.txt --aad "metadata"

# Дешифрование Encrypt-then-MAC
cryptocore encrypt --decrypt --mode etm --key 001122... --input encrypted.bin
```

---

### **3. Команда `dgst` - Хеширование и HMAC**

**Назначение:** Вычисление хеш-сумм и HMAC файлов.

**Синтаксис:**
```bash
cryptocore dgst [опции]
```

**Опции:**
- `--algorithm sha256|sha3-256` - алгоритм хеширования
- `--input FILE` - входной файл
- `--output FILE` - файл для вывода
- `--hmac` - включить режим HMAC
- `--key KEY` - ключ для HMAC (hex)
- `--verify FILE` - проверка HMAC
- `-v, --verbose` - подробный вывод

**Примеры:**
```bash
# Хеш SHA-256
cryptocore dgst --algorithm sha256 --input file.txt

# HMAC-SHA256
cryptocore dgst --algorithm sha256 --hmac --key 001122... --input file.txt

# Проверка HMAC
cryptocore dgst --algorithm sha256 --hmac --key 001122... --input file.txt --verify expected.txt
```

---

## **Реализованные требования спринта 7**

### **✅ Структура проекта и гигиена репозитория**
- Создана директория `src/kdf/` для KDF-функций
- Добавлены файлы `pbkdf2.py` и `hkdf.py`
- Поддержана обратная совместимость

### **✅ Командный интерфейс (CLI)**
- Реализована команда `derive` с полным набором параметров:
  - Поддержка пароля из аргументов, файла или переменной окружения
  - Генерация случайной соли при необходимости
  - Вывод в формате `KEY_HEX SALT_HEX`
  - Опция записи ключа в бинарный файл

### **✅ Реализация функций получения ключей**
1. **PBKDF2-HMAC-SHA256 с нуля:**
   - Соответствие RFC 2898
   - Использование HMAC-SHA256 из спринта 5
   - Поддержка итераций до 1,000,000
   - Обработка произвольных длин пароля и соли

2. **Функция иерархии ключей:**
   - Сигнатура: `derive_key(master_key, context, length)`
   - Детерминированная генерация через HMAC
   - Уникальные ключи для разных контекстов

### **✅ Файловый ввод-вывод**
- Безопасное чтение паролей из разных источников
- Генерация случайной соли через CSPRNG
- Запись ключей в бинарном формате
- Очистка паролей из памяти

### **✅ Тестирование и верификация**
- Тестовые векторы RFC 6070 для PBKDF2
- Тесты детерминированности и длины
- Межплатформенная совместимость с OpenSSL
- Тесты уникальности сгенерированных солей
- Производительность при разных итерациях

### **✅ Дополнительные улучшения**
- Интеграция с существующей архитектурой
- Подробный режим вывода (`-v`)
- Обработка ошибок аутентификации
- Безопасное удаление файлов при ошибках


### **Модульность:**
```

├── kdf/
│   ├── pbkdf2.py    # PBKDF2 реализация
│   └── hkdf.py      # Иерархия ключей
├── mac/
│   └── hmac.py      # HMAC (спринт 5)
└── modes/           # Режимы шифрования
```

### **Безопасность:**
- Криптографически стойкий генератор случайных чисел
- Минимальная длина соли 16 байт
- Рекомендуемые итерации PBKDF2: 100,000
- Очистка чувствительных данных из памяти

### **Производительность:**
- Оптимизированные циклы PBKDF2
- Потоковая обработка больших файлов
- Эффективное использование памяти


## **Заключение**

Спринт 7 успешно расширил функциональность CryptoCore возможностями безопасного получения ключей из паролей. Реализация соответствует всем требованиям технического задания, проходит все тесты и совместима с существующей архитектурой. Инструмент теперь поддерживает полный цикл криптографических операций: от генерации ключей до защищенного шифрования с аутентификацией.
