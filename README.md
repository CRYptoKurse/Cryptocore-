
## Краткое описание CryptoCore
CryptoCore — это криптографическая утилита командной строки, реализующая шифрование/дешифрование AES в различных режимах, включая аутентифицированное шифрование (GCM и Encrypt-then-MAC), а также вычисление хешей и HMAC.

## Руководство по использованию

### 1. Шифрование/дешифрование
**Основная команда:** `cryptocore encrypt`

| Опция | Обязательность | Описание | Пример |
|-------|---------------|----------|--------|
| `--algorithm aes` | Да | Алгоритм шифрования | `--algorithm aes` |
| `--mode` | Да | Режим: `ecb`, `cbc`, `cfb`, `ofb`, `ctr`, `gcm`, `etm` | `--mode gcm` |
| `--key HEX` | Нет* | Ключ в hex (16/24/32 байта) | `--key 00112233445566778899aabbccddeeff` |
| `--input FILE` | Да | Входной файл | `--input plain.txt` |
| `--output FILE` | Нет | Выходной файл (автоимя если не указано) | `--output cipher.bin` |
| `--iv HEX` | Нет | IV/nonce в hex (16 или 12 байт для GCM) | `--iv 000000000000000000000000` |
| `--aad HEX` | Нет | Ассоциированные данные (только GCM/ETM) | `--aad aabbccddeeff` |
| `--decrypt` | Нет | Флаг для дешифрования | `--decrypt` |
| `-v` | Нет | Подробный вывод | `-v` |

**Примеры команд:**
```bash
# GCM шифрование с AAD
cryptocore encrypt --algorithm aes --mode gcm --encrypt --key 00112233445566778899aabbccddeeff --input plain.txt --output cipher.bin --aad aabbccddeeff

# GCM дешифрование
cryptocore encrypt --decrypt --algorithm aes --mode gcm --key 00112233445566778899aabbccddeeff --input cipher.bin --output decrypted.txt --aad aabbccddeeff

# ETM шифрование (требуется ключ ≥32 байта)
cryptocore encrypt --algorithm aes --mode etm --key 00112233445566778899aabbccddeeff00112233445566778899aabbccddeeff --input data.txt --output encrypted.bin --aad metadata

# Базовое CBC шифрование
cryptocore encrypt --algorithm aes --mode cbc --key 00112233445566778899aabbccddeeff --input file.txt --output file.enc
```

### 2. Хеширование и HMAC
**Команда:** `cryptocore dgst`

| Опция | Обязательность | Описание | Пример |
|-------|---------------|----------|--------|
| `--algorithm` | Да | `sha256` или `sha3-256` | `--algorithm sha256` |
| `--input FILE` | Да | Входной файл | `--input file.txt` |
| `--output FILE` | Нет | Файл для вывода | `--output hash.txt` |
| `--hmac` | Нет | Включить режим HMAC | `--hmac` |
| `--key HEX` | Если `--hmac` | Ключ для HMAC | `--key 00112233445566778899aabbccddeeff` |
| `--verify FILE` | Нет | Проверить хеш/HMAC | `--verify expected.txt` |
| `-v` | Нет | Подробный вывод | `-v` |

**Примеры команд:**
```bash
# Вычисление SHA-256
cryptocore dgst --algorithm sha256 --input document.pdf

# Вычисление HMAC-SHA256
cryptocore dgst --algorithm sha256 --hmac --key 00112233445566778899aabbccddeeff --input data.bin

# Проверка HMAC
cryptocore dgst --algorithm sha256 --hmac --key 00112233445566778899aabbccddeeff --input data.bin --verify hmac.txt
```

## Реализованные требования спринта 6

### ✅ Основные достижения:
1. **Реализация GCM с нуля** — полноценный режим аутентифицированного шифрования с умножением в поле Галуа GF(2¹²⁸)
2. **Реализация Encrypt-then-MAC** — составная AEAD схема (CTR + HMAC-SHA256)
3. **Расширение CLI** — добавлены:
   - Режимы `gcm` и `etm` для аргумента `--mode`
   - Аргумент `--aad` для ассоциированных данных
   - Автоматическая обработка 12-байтовых nonce для GCM
4. **Катастрофический отказ при ошибках аутентификации**:
   - Никакой вывод расшифрованных данных при неудачной проверке
   - Удаление частично созданных файлов
   - Четкие сообщения об ошибках и ненулевые коды завершения
5. **Корректная обработка форматов данных**:
   - Для шифрования: `nonce(12) + ciphertext + tag(16)`
   - Для дешифрования: извлечение nonce из файла или аргумент `--iv`

### ✅ Технические детали реализации:
- **GCM**: Полное соответствие NIST SP 800-38D с поддержкой:
  - 12-байтовых nonce (рекомендованный размер)
  - Произвольных AAD и сообщений
  - Тегов аутентификации 128 бит
- **ETM**: Разделение ключей, комбинация CTR режима и HMAC-SHA256
- **Безопасность**: Защита от атак на целостность, проверка тегов до вывода данных
- **Производительность**: Предвычисление таблиц для умножения в поле Галуа

### ✅ Структура проекта:
- Новые модули: `modes/gcm.py`, `aead/encrypt_then_mac.py`
- Интеграция с существующей кодbase
- Совместимость с предыдущими спринтами

### ✅ Тестирование :
- Тестовые векторы NIST для GCM
- Тесты "туда-обратно"
- Тесты искажения данных и AAD
- Тесты совместимости и пограничных случаев

Все основные требования спринта 6 успешно реализованы, инструмент готов к использованию для безопасного аутентифицированного шифрования.
